!function(e){var t={};function i(s){if(t[s])return t[s].exports;var r=t[s]={i:s,l:!1,exports:{}};return e[s].call(r.exports,r,r.exports,i),r.l=!0,r.exports}i.m=e,i.c=t,i.d=function(e,t,s){i.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:s})},i.r=function(e){"undefined"!=typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},i.t=function(e,t){if(1&t&&(e=i(e)),8&t)return e;if(4&t&&"object"==typeof e&&e&&e.__esModule)return e;var s=Object.create(null);if(i.r(s),Object.defineProperty(s,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)i.d(s,r,function(t){return e[t]}.bind(null,r));return s},i.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return i.d(t,"a",t),t},i.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},i.p="",i(i.s=0)}([function(e,t,i){"use strict";i.r(t);var s=class{constructor(){let e={},t={};Object.defineProperty(this,"completeFns",{get:function(){return e}}),Object.defineProperty(this,"onceFns",{get:function(){return t}})}on(e,t){this.completeFns[e]||(this.completeFns[e]={});let i=null;do{i=(Math.random()+1).toString(36).substring(2,10)}while(Object.keys(this.completeFns).indexOf(i)>-1);return t="function"==typeof t?{fn:t,scope:null}:t,this.completeFns[e][i]={scope:t.scope,fn:t.fn},i}once(e,t){this.onceFns[e]||(this.onceFns[e]={});let i=null;do{i=(Math.random()+1).toString(36).substring(2,10)}while(Object.keys(this.completeFns).indexOf(i)>-1);t="function"==typeof t?{fn:t,scope:null}:t,this.onceFns[e][i]={scope:t.scope,fn:t.fn}}off(e,t){return!(!e||!t)&&(!(!this.completeFns[e]||!this.completeFns[e][t])&&(delete this.completeFns[e][t],!0))}emit(e,t){let i=Array.prototype.slice.call(arguments);e=i[0],t=i.slice(1),["completeFns","onceFns"].forEach(i=>{if(this[i][e])for(let s in this[i][e]){let r=this[i][e][s].scope,o=this[i][e][s].fn;(function(){o.apply(r,t)}).bind(r)()}}),this.onceFns[e]&&delete this.onceFns[e]}};const r={xhr:(e,t)=>new Promise((i,s)=>{if(!e)return void s("no url");const r=new XMLHttpRequest,o=(t&&t.type||"GET").toUpperCase();if(r.open(o,e,!0),t&&t.hasOwnProperty("attributes"))for(let e in t.attributes)r.setAttribute(e,t.attributes[e]);if(t&&t.hasOwnProperty("properties"))for(let e in t.properties)r[e]=t.properties[e];if(t&&t.hasOwnProperty("requestHeaders"))for(let e in t.requestHeaders)r.setRequestHeader(e,t.requestHeaders[e]);r.onload=e=>{200==r.status?i(r.response):s(e)},r.onerror=e=>{s(e)},r.send(t&&t.data?t.data:null)}),createElement:(e,t)=>{if("string"!=typeof e)return null;let i=document.createElement(e);if(!t)return i;if(t.text&&(i.innerText=t.text),t.html&&(i.innerHTML=t.html),t.id&&(i.id=t.id),(t.class||t.className)&&(i.className=t.class||t.className),t.type&&(i.type=t.type),t.name&&(i.name=t.name),t.value&&(i.value=t.value),t.for&&i.setAttribute("for",t.for),t.data)for(let e in t.data)i.setAttribute(`data-${e}`,t.data[e]);if(t.style)for(let e in t.style)i.style[e]=t.style[e];if(t.prop)for(let e in t.prop)i[e]=t.prop[e];if(t.attrib)for(let e in t.attrib)i.setAttribute(e,t.attrib[e]);return i},getParameters:()=>(window.location.href.split("?")[1]||"").split("&").map(e=>e.split("=")).filter(e=>2===e.length).reduce((e,t)=>(e[t[0]]=t[1],e),{}),log:e=>{r.getParameters().debug&&"true"===r.getParameters().debug&&console.log(e)}};var o=r;var n=class extends s{constructor(){super();let e,t={};Object.defineProperty(this,"chosen",{get:function(){return t}}),Object.defineProperty(this,"language",{get:function(){return e},set:function(s){if("string"==typeof s&&(e=s,i)){t=i.filter(t=>e.indexOf(t.short)>-1).reduce((e,t)=>t,{}),localStorage.setItem("language",s);let r=JSON.parse(JSON.stringify(t));r.language=e,r.translation=this[e]||this.en,this.emit("translations.set",r)}}});let i=JSON.parse(localStorage.getItem("languagePacks")||"[]");Object.defineProperty(this,"languages",{get:function(){return i},set:function(s){if(s&&"object"==typeof s&&(i=s,this.emit("translations.languages",s),e)){t=s.filter(t=>e.indexOf(t.short)>-1).reduce((e,t)=>t,{});let i=JSON.parse(JSON.stringify(t));i.language=e,i.translation=this[e]||this.en,localStorage.setItem("languagePacks",JSON.stringify(s)),this.emit("translations.set",i)}}}),this.getTranslations().then(()=>{this.emit("translations.received")}),this.setLanguages(),this.language=localStorage.getItem("language")||navigator.language}getTranslations(){return new Promise((e,t)=>{o.xhr("/res/translations.json",{properties:{responseType:"json"}}).then(t=>{for(let e in t){this[e]={};for(let i in t[e])this[e][i]=t[e][i]}e()}).catch(e=>t(e))})}getLanguages(){return new Promise((e,t)=>{o.xhr("/res/languages.json",{properties:{responseType:"json"}}).then(t=>e(t)).catch(e=>t(e))})}setLanguages(){this.getLanguages().then(e=>this.languages=e).catch(e=>console.log(e))}setLanguage(e){this.language=e}translate(e){return this[this.language][e]||this.en[e]||""}};var a=class extends s{constructor(e,t){super();let i=['video/webm;codecs="vp9,opus"','video/webm;codecs="vp9.0,opus"','video/webm;codecs="avc1"','video/x-matroska;codecs="avc1"','video/webm;codecs="vp8,opus"'].filter(e=>MediaRecorder.isTypeSupported(e)),s=[];t=t||e.getVideoTracks().length?i[0]:"audio/ogg;codecs=opus",this.recorder=new MediaRecorder(e,{mimeType:t}),this.recorder.ondataavailable=function(e){e.data.size>0&&s.push(e.data)},this.recorder.onerror=e=>{this.emit("record.error",e)},this.recorder.onstart=e=>{this.emit("record.start",!0)},this.result=null,this.recorder.onstop=e=>{let t=("audio"==this.deviceType?"audio":"video")+"/webm";this.result=new Blob(s,{type:t});let i=URL.createObjectURL(this.result);this.emit("record.complete",{url:i,media:this.result}),this.recorder=null},Object.defineProperty(this,"recData",{get:function(){return s}}),this.isRecording=!1,this.isPaused=!1}start(e){e=e||0,this.isRecording?this.isPaused&&this.resume():(setTimeout(()=>{this.recorder.start()},e),this.isRecording=!0)}pause(){this.isPaused?this.resume():this.recorder.pause(),this.isPaused=!this.isPaused}resume(){"paused"===this.recorder.state&&this.recorder.resume()}stop(){this.recorder.stop(),this.isRecording=!1}};class c extends s{constructor(e){super();let t=null;this.recorder=null,this.cachedAudioTracks=[],Object.defineProperty(this,"stream",{get:function(){return t},set:function(e){e instanceof MediaStream?(t=e,this.emit("stream",t)):null===e&&(t=e)}});let i=e;Object.defineProperty(this,"info",{get:function(){return i},configurable:!1,enumerable:!1}),this.deviceType=e.deviceType||("audioinput"===e.kind?"audio":"video");let s={audio:{exact:e.deviceId}},r={audio:!0,video:{exact:e.deviceId,facingMode:"user"}},o={firefox:{video:{mediaSource:"screen",frameRate:{ideal:10,max:15}}},chrome:{audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:null,maxWidth:window.screen.width,maxHeight:window.screen.height}}},other:null},n=window.hasOwnProperty("InstallTrigger")?"firefox":window.hasOwnProperty("chrome")&&chrome.app?"chrome":"other";this.isChrome="chrome"===n,Object.defineProperty(this,"browser",{get:function(){return n}}),Object.defineProperty(this,"constraints",{get:function(){switch(this.deviceType){case"audio":return s;case"video":return r;case"desktop":return o[n]}},enumerable:!1}),"desktop"===this.deviceType&&"chrome"===n&&window.addEventListener("message",e=>{e.data.type&&"SS_DIALOG_SUCCESS"==e.data.type&&this.emit("streamId",e.data.streamId)})}connect(e){return"desktop"===this.deviceType&&"getDisplayMedia"in navigator.mediaDevices?this.connectDisplayMedia():"desktop"===this.deviceType&&this.isChrome?this.connectChromeDesktop(e):new Promise((t,i)=>{for(var s in e=e||{})"desktop"===this.deviceType?this.constraints.video[s]=e[s]:this.constraints[this.deviceType][s]=e[s];navigator.mediaDevices.getUserMedia(this.constraints).then(e=>{this.isChrome||"desktop"!==this.deviceType||this.cachedAudioTracks.forEach(t=>e=new MediaStream([t,...e.getVideoTracks(),...e.getAudioTracks()])),this.stream=e,t(e)}).catch(e=>i(e))})}connectDisplayMedia(){return new Promise((e,t)=>navigator.mediaDevices.getDisplayMedia().then(t=>{this.stream=t,this.cachedAudioTracks.forEach(e=>this.stream.addTrack(e)),e(t)}).catch(e=>t(e)))}connectChromeDesktop(e){return new Promise((t,i)=>{this.once("streamId",{fn:function(s){for(var r in this.constraints.video.mandatory.chromeMediaSourceId=s,e=e||{})this.constraints.video.mandatory["max"+r.charAt(0).toUpperCase()+r.substring(1)]=e[r];navigator.mediaDevices.getUserMedia(this.constraints).then(e=>{this.stream=e,this.cachedAudioTracks.forEach(e=>this.stream.addTrack(e)),t(e)}).catch(e=>i(e))},scope:this}),window.postMessage({type:"SS_UI_REQUEST",text:"start",url:location.origin},"*")})}attachAudioTrack(e){if(e instanceof MediaStream||e instanceof MediaStreamTrack)try{let t=e instanceof MediaStreamTrack?e:e.getAudioTracks()[0];this.stream?(this.isChrome?this.stream.addTrack(t):this.stream=new MediaStream([t,...this.stream.getVideoTracks(),...this.stream.getAudioTracks()]),this.emit("stream.mute")):this.cachedAudioTracks.push(t)}catch(e){}}changeResolution(e){return"string"==typeof e&&(e={width:4*parseInt(e)/3,height:parseInt(e)}),this.stream.getVideoTracks().forEach(e=>e.stop()),this.stream=null,this.connect(e)}record(){if(this.recorder)this.recorder.resume();else{if(!this.stream)throw new Error("Can't record as stream is not active");this.recorder=new a(this.stream),this.recorder.on("record.complete",e=>{this.emit("record.complete",e),this.recorder=null}),this.recorder.start(1e3)}}stopRecording(){this.recorder&&(this.recorder.stop(),this.emit("record.prepare",this.info.label)),this.stream.getVideoTracks().forEach(e=>e.stop()),this.stream.getAudioTracks().forEach(e=>e.stop());let e=this.stream;this.stream=null,this.emit("record.stop.stream.remove",e)}pauseRecording(){this.recorder.pause()}}var d=class extends s{constructor(e){super(),this.streams={},this.streamOrder=[],this.codecs="MediaRecorder"in window?['video/webm;codecs="vp9,opus"','video/webm;codecs="vp9.0,opus"','video/webm;codecs="avc1"','video/x-matroska;codecs="avc1"','video/webm;codecs="vp8,opus"'].filter(e=>MediaRecorder.isTypeSupported(e)):[],this.recorder=null,this.recData=[],this.canvas=document.createElement("canvas"),this.width=1280,this.height=720,this.setDimensions(e);let t=null;Object.defineProperty(this,"stream",{get:function(){return t},set:function(e){(null===e||e instanceof MediaStream)&&(t=e,e&&this.emit("stream",{stream:e,id:"composite"}))}}),this.rafToken=null,Object.defineProperty(this,"dimensions",{get:function(){return{width:this.width,height:this.height}}});let i=window.hasOwnProperty("InstallTrigger")?"firefox":window.hasOwnProperty("chrome")&&chrome.app?"chrome":"other";this.isChrome="chrome"===i}setDimensions(e){let t=!1,i=this.width,s=this.height;if(this.stream&&(t=!0,this.stop()),this.width=e&&e.width||1280,this.height=e&&e.height||720,this.canvas.width=this.width,this.canvas.height=this.height,this.ctx=this.canvas.getContext("2d"),t){for(let e in this.streams)this.streams[e].offsetX=Math.floor(this.streams[e].offsetX/i*this.width),this.streams[e].offsetY=Math.floor(this.streams[e].offsetY/s*this.height),this.streams[e].width=Math.floor(this.streams[e].width/i*this.width),this.streams[e].height=Math.floor(this.streams[e].height/s*this.height);this.start()}}addStream(e){if(this.streams.hasOwnProperty(e.id))return this.streams[e.id].active=!0,void(this.streams[e.id].stream.id!=e.stream.id&&(this.streams[e.id].stream=e.stream,this.streams[e.id].video.srcObject=e.stream));if(Object.keys(this.streams).length>4)throw new Error("max streams attached");let t=document.createElement("video");t.autoplay=!0,t.muted=!0,t.onloadedmetadata=()=>{let i=this.getPosition(t,e.id);this.streams[e.id]={id:e.id,stream:e.stream,video:t,active:!0,offsetX:i.offsetX,offsetY:i.offsetY,width:i.width,height:i.height},"desktop"==e.id?this.streamOrder.unshift(e.id):this.streamOrder.push(e.id)},t.srcObject=e.stream,"function"==typeof t.play&&t.play(),this.stream&&e.stream.getAudioTracks().length&&this.addAudioTrack(e.stream.getAudioTracks()[0])}removeStream(e){return new Promise((t,i)=>{this.streams.hasOwnProperty(e)?delete this.streams[e]:i("no such stream")})}getPosition(e,t){switch(t){case"desktop":return{width:Math.min(e.videoWidth,this.width),height:Math.min(e.videoHeight,this.height),offsetX:0,offsetY:(this.height-Math.min(e.videoHeight,this.height))/2};default:let t=e.videoWidth/e.videoHeight,i=t>1,s=i?this.width/4:this.height/4*t,r=i?this.width/4/t:this.height/4,o=this.getDefaultOffsets(s,r);return{width:s,height:r,offsetX:o.x,offsetY:o.y}}}getDefaultOffsets(e,t){let i=this.width-e,s=this.height-t;for(let t in this.streams)if("desktop"!==t){let r=this.streams[t];i>=r.offsetX&&i<r.offsetX+r.width&&s>=r.offsetY&&s<r.offsetY+r.height&&(i=Math.max(0,r.offsetX-e))}return{x:i,y:s}}draw(){this.streamOrder.filter(e=>this.streams[e].active).map(e=>this.streams[e]).forEach(e=>{this.ctx.drawImage(e.video,e.offsetX,e.offsetY,e.width,e.height)})}start(){this.emit("subscribe.raf",this.draw,(function(e){this.rafToken=e})),this.stream=this.canvas.captureStream(30);for(let e in this.streams){let t=this.streams[e];t.stream.getAudioTracks().length&&this.addAudioTrack(t.stream.getAudioTracks()[0])}}stop(){this.emit("unsubscribe.raf",this.rafToken,()=>this.rafToken=null),this.stream=null,this.emit("stream.remove","composite")}addAudioTrack(e){this.isChrome?this.stream.addTrack(e):this.stream=new MediaStream([e,...this.stream.getVideoTracks(),...this.stream.getAudioTracks()]),this.emit("stream.mute")}record(){this.stream&&(this.recorder?"paused"===this.recorder.state&&this.recorder.resume():(this.recorder=new a(this.stream),this.recorder.on("record.complete",e=>{e.id="compositor",this.emit("record.complete",e),this.recorder=null}),this.recorder.start(1e3)))}stopRecording(){this.recorder&&(this.recorder.stop(),this.emit("record.prepare",{label:"compositor",id:"compositor",flavor:"Composite"}))}pauseRecording(){this.recorder&&this.recorder.pause()}changeResolution(e){let t=parseInt(e),i=Math.ceil(t/9*16);return new Promise((e,s)=>{this.setDimensions({width:i,height:t}),e({stream:this.stream})})}};const l=function(){this.subscriptions={},this.loop()};l.prototype={constructor:l,loop:function(e){for(let t in this.subscriptions)if(this.subscriptions[t].active){let i=this.subscriptions[t].fn,s=this.subscriptions[t].scope;i.call(s,e)}requestAnimationFrame(e=>this.loop(e))},subscribe:function(e,t){if(e.fn&&"function"==typeof e.fn){let i=null;do{i=(Math.random()+1).toString(36).substring(2,10)}while(Object.keys(this.subscriptions).indexOf(i)>-1);return this.subscriptions[i]={fn:e.fn,scope:e.scope,active:!0},t&&"function"==typeof t&&t.call(e.scope,i),i}},unsubscribe:function(e,t){let i=!1;return this.subscriptions.hasOwnProperty(e)&&(delete this.subscriptions[e],i=!0),t&&"function"==typeof t&&t(i),i},pauseExecution:function(e){let t=!1;return this.subscriptions.hasOwnProperty(e)&&(this.subscriptions[e].active=!1,t=!0),t},resumeExecution:function(e){let t=!1;return this.subscriptions.hasOwnProperty(e)&&(this.subscriptions[e].active=!0,t=!0),t}};var h=l,u=function(e){this.audioSource=null,this.audioId=null,this.canvas=null,this.canvasCtx=null,this.WIDTH=0,this.height=0,this.noCanvas=e,this.audioCtx=null,this.analyser=null,this.bufferLength=0,this.dataArray=null,this.analysisState=!1;var t={};Object.defineProperty(this,"subscriptions",{get:function(){return t}});var i={};Object.defineProperty(this,"delegations",{get:function(){return i}}),this.rafTokens={performCalc:null}};u.prototype={constructor:u,init:function(){this.analyser.fftSize=128},attachCanvas:function(e){e=e[0]||e,this.canvas!==e&&(this.canvas=e,this.setCanvasDimensions(e))},setCanvasDimensions:function(e,t){this.canvas.width=this.WIDTH=this.canvas.clientWidth,this.canvas.height=this.HEIGHT=this.canvas.clientHeight,this.canvasCtx=this.canvas.getContext("2d"),this.canvasCtx.lineWidth=this.canvas.height-2,this.canvasCtx.lineCap="round",this.canvasCtx.fillStyle=t?"rgba(255,255,255,0.3)":"white",this.canvasCtx.strokeStyle="#09f"},analyse:function(e){this.audioCtx=new(AudioContext||webkitAudioContext),this.analyser=this.audioCtx.createAnalyser(),this.audioSource=this.audioCtx.createMediaStreamSource(e),this.audioSource.connect(this.analyser),this.bufferLength=this.analyser.frequencyBinCount,this.dataArray=new Uint8Array(this.bufferLength),this.analysisState=!0,this.noCanvas||this.canvasCtx.fillRect(0,0,this.WIDTH,this.HEIGHT),this.delegate("subscribe.raf",this.performCalc,e=>{this.rafTokens.performCalc=e})},performCalc:function(e){try{this.analyser.getByteTimeDomainData(this.dataArray);let e=Math.sqrt(this.dataArray.reduce((e,t)=>e+Math.pow((t-128)/128,2),0));this.notifyDependencies("magnitude",e),this.noCanvas||this.drawFn(e)}catch(e){console.log(e)}},stopAnalysis:function(){this.analysisState=!1,this.notify(0)},draw:function(e){this.canvasCtx.fillRect(0,0,this.WIDTH,this.HEIGHT),this.canvasCtx.beginPath(),this.canvasCtx.moveTo(this.HEIGHT/2,this.HEIGHT/2);let t=Math.max(e/16*this.WIDTH,this.HEIGHT/2);this.canvasCtx.lineTo(t,this.HEIGHT/2),this.canvasCtx.stroke()},drawMerged:function(e){this.canvasCtx.clearRect(0,0,this.WIDTH,this.HEIGHT),this.canvasCtx.beginPath();let t=e/16*this.WIDTH;this.canvasCtx.lineWidth=t,this.canvasCtx.moveTo(this.HEIGHT/2,this.HEIGHT/2),this.canvasCtx.lineTo(this.HEIGHT/2,this.HEIGHT/2),this.canvasCtx.stroke()},drawFn:function(e){return this.draw(e)},switchDraw:function(e){"string"==typeof e&&this.__proto__[e]&&(this.delegate("pause.raf",this.rafTokens.performCalc),this.clearCanvas(),setTimeout(()=>{this.setCanvasDimensions(this.canvas,"drawMerged"===e),this.__proto__.drawFn=this.__proto__[e],this.delegate("resume.raf",this.rafTokens.performCalc)},1500))},clearCanvas:function(){this.canvasCtx.fillRect(0,0,this.WIDTH,this.HEIGHT)},on:function(e,t){this.subscriptions.hasOwnProperty(e)||(this.subscriptions[e]={});var i=Object.keys(this.subscriptions);let s=null;do{s=(1+Math.random()).toString(36).substring(2,10)}while(i.indexOf(s)>-1);this.subscriptions[e][s]=t},notifyDependencies:function(e,t){if(this.subscriptions.hasOwnProperty(e))for(var i in this.subscriptions[e])this.subscriptions[e][i](t)},delegate:function(){let e=Array.prototype.slice.call(arguments);this.delegations.hasOwnProperty(e[0])&&this.delegations[e[0]].forEach(t=>{t.apply(this,e.slice(1))})},ondelegation:function(e,t){this.delegations.hasOwnProperty(e)||(this.delegations[e]=[]),this.delegations[e].push(t)}};var m=u;function p(e){this.server_url=e.getServerUrl(),this.workflow_id=e.getWorkflowId(),this.login_name=e.getLoginName(),this.login_password=e.getLoginPassword()}function g(){this.openSettingsButton=document.getElementById("ocUploadSettingsOpenButton"),this.openSettingsButton.addEventListener("click",this.show.bind(this),!1),this.openOcServerButton=document.getElementById("ocOpenServerButton"),this.openOcServerButton.addEventListener("click",this.openOcServer.bind(this),!1),this.toggleModalEl=document.getElementById("toggleOcUploadSettingsModal"),this.saveOcUploadSettingsEl=document.getElementById("saveOcUploadSettings"),this.serverURLEl=document.querySelector("#ocUploadSettings input[name=ocUploadSettingsServerURL]"),this.workflowIdEl=document.querySelector("#ocUploadSettings input[name=ocUploadSettingsWorkflowId]"),this.loginNameEl=document.querySelector("#ocUploadSettings input[name=ocUploadSettingsLoginName]"),this.loginPasswordEl=document.querySelector("#ocUploadSettings input[name=ocUploadSettingsLoginPassword]"),this.serverURLEl.value=localStorage.getItem("ocUploadSettingsServerURL"),this.workflowIdEl.value=localStorage.getItem("ocUploadSettingsWorkflowId"),this.loginNameEl.value=localStorage.getItem("ocUploadSettingsLoginName"),this.loginPasswordEl.value=localStorage.getItem("ocUploadSettingsLoginPassword"),""===this.workflowIdEl.value&&""===this.serverURLEl.value&&""===this.loginNameEl.value&&""===this.loginPasswordEl.value&&(this.workflowIdEl.value="fast",this.serverURLEl.value="https://develop.opencast.org/",this.loginNameEl.value="admin",this.loginPasswordEl.value="opencast",this.show()),this.saveOcUploadSettingsEl.addEventListener("click",this.saveAndCloseOcUploadSettings.bind(this),!1)}function f(){this.socket=null,this.bt=null,this.nfc=null,"undefined"!=typeof io&&io&&(this.socket=io(),this.socket.on("welcome",e=>app.socketId=e),this.socket.on("pairCode",e=>app.displayPairCode(e)),this.socket.on("peerConnection",e=>(function(e){peers[e.target]||(peers[e.target]=new PeerConnection(e),peers[e.target].on("connection.connected",()=>(function(e){let t=document.querySelector('#streams li[data-id="'+e.target+'"]'),i=!1;if(peers[e.target].stream&&peers[e.target].stream.getVideoTracks().length>0){i=!0;let s=document.createElement("video"),r=o.createElement("span",{class:"mediaContainer"}),n=o.createElement("span",{class:"front"}),a=o.createElement("ul",{class:"back"}),c=o.createElement("li"),d=o.createElement("button",{text:"Disconnect"});c.appendChild(d);let l=o.createElement("li"),h=o.createElement("button",{text:"Toggle composite"});l.appendChild(h);let u=o.createElement("li"),m=o.createElement("button",{text:"Remote details"});u.appendChild(m),a.appendChild(c),a.appendChild(l),a.appendChild(u),s.autoplay=!0,s.muted=!0,r.appendChild(n),r.appendChild(a),n.appendChild(s),t.appendChild(r),s.srcObject=peers[e.target].stream,t.classList.add("streaming"),t.classList.remove("connecting"),t.classList.add("active"),r.classList.add("active"),t.addEventListener("click",app.toggleDevice.bind(app),!1),h.addEventListener("click",app.addPeerStreamToComposite.bind(app),!1),t.setAttribute("data-title","Remote stream")}else if(!peers[e.target].stream){i=!0;let s=document.createElement("canvas"),r=o.createElement("span",{class:"mediaContainer"}),n=o.createElement("span",{class:"front"}),a=o.createElement("span",{class:"back"});r.appendChild(n),r.appendChild(a),n.appendChild(s),t.appendChild(r),t.classList.add("streaming"),t.classList.remove("connecting"),t.classList.add("active"),r.classList.add("active"),t.addEventListener("click",app.toggleDevice.bind(app),!1),t.setAttribute("data-title","Whiteboard"),peers[e.target].displayCanvas=s}if(i){let t={};t[e.target]={deviceType:"video",source:"peer",info:{label:`Remote peer ${Object.keys(peers).length}: ${peers[e.target].stream?"stream":"whiteboard"}`,type:peers[e.target].stream?"video":"whiteboard"}},app.listAsSource(t)}})(e)),peers[e.target].on("record.prepare",e=>{app.listRecording(e)}),peers[e.target].on("record.complete",e=>{app.setMediaLink(e)}),peers[e.target].on("record.raw",e=>{app.setMediaLink(e);let t=document.querySelector(`#recordingList a[data-id="${e.id}"]`);t?t.classList.remove("transfer"):console.log("no such peer listing")}),peers[e.target].on("connection.disconnected",()=>{app.removePeer(e.target)}));peers[e.target].handleRequest(e)})(e))),this.transportOrder=["SOCKET"],this.transportOrder.some(e=>{if(this[e.toLowerCase()])return this.switchTransport(e)})}p.prototype={constructor:p,loginAndUploadFromAnchor:async function(e,t,i,s,r,o,n){let a=!0;try{a=await this.validateState()}catch(e){return void s(e)}a||await this.login(),this.uploadFromAnchor(e,t,i,s,r,o,n)},uploadFromAnchor:async function(e,t,i,s,r,o,n){try{if(!await this.validateState())return void i()}catch(e){return void s(e)}try{let t=await this.getMediaPackage().then(e=>{let t=(new DOMParser).parseFromString('<?xml version="1.0" encoding="UTF-8"?><dublincore xmlns="http://www.opencastproject.org/xsd/1.0/dublincore/"            xmlns:dcterms="http://purl.org/dc/terms/"            xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance">  <dcterms:created xsi:type="dcterms:W3CDTF">2001-01-01T01:01Z</dcterms:created>  <dcterms:creator>Creator not set</dcterms:creator>  <dcterms:extent xsi:type="dcterms:ISO8601">PT5.568S</dcterms:extent>  <dcterms:title>Title Not Set</dcterms:title></dublincore>',"text/xml"),i=t.getElementsByTagName("dcterms:created"),s=t.getElementsByTagName("dcterms:creator"),r=t.getElementsByTagName("dcterms:title");return i[0].textContent=new Date(Date.now()).toISOString(),s[0].textContent=n,r[0].textContent=o,this.addDCCatalog(e,(new XMLSerializer).serializeToString(t),"dublincore/episode")});for(let i in e){let s=e[i],r=await this.retrieve_blob(s.href),o=s.getAttribute("data-flavor"),n="presentation/source";"Presentation"===o?n="presentation/source":"Presenter"===o?n="presenter/source":"Composite"===o&&(n="composite/preview"),t=await this.addTrack(t,r,s.download,n,"")}t=await this.ingest(t,this.workflow_id)}catch(e){return void r(e)}t()},validateState:async function(){let e=await this.getMeInfo();return"anonymous"!==JSON.parse(e).user.username},login:function(){let e="j_username="+this.login_name+"&j_password="+this.login_password+"&_spring_security_remember_me=on";return this.cred_xhr(this.server_url+"admin_ng/j_spring_security_check","POST",e,!0)},getMeInfo:function(){return this.cred_xhr(this.server_url+"info/me.json")},getMediaPackage:function(){return this.cred_xhr(this.server_url+"ingest/createMediaPackage")},addDCCatalog:function(e,t,i){let s=new FormData;return s.append("mediaPackage",e),s.append("dublinCore",t),s.append("flavor",i),this.cred_xhr(this.server_url+"ingest/addDCCatalog","POST",s)},addTrack:function(e,t,i,s,r){let o=new FormData;return o.append("mediaPackage",e),o.append("flavor",s),o.append("tags",r),o.append("BODY",t,i),this.cred_xhr(this.server_url+"ingest/addTrack","POST",o)},ingest:function(e,t){let i=new FormData;return i.append("mediaPackage",e),i.append("workflowDefinitionId",t),this.cred_xhr(this.server_url+"ingest/ingest","POST",i)},cred_xhr:function(e,t,i,s){let r={properties:{withCredentials:!0,responseType:"text"}};return r.type=t,r.data=i,r.requestHeaders={},s&&(r.requestHeaders["Content-Type"]="application/x-www-form-urlencoded"),o.xhr(e,r)},retrieve_blob:function(e){return o.xhr(e,{properties:{responseType:"blob"}})}},g.prototype={constructor:g,show:function(){this.toggleModalEl.checked=!0},openOcServer:function(){let e=this.getServerUrl();""!=e&&"/"!==e&&window.open(this.getServerUrl())},saveAndCloseOcUploadSettings:function(e){localStorage.setItem("ocUploadSettingsServerURL",this.serverURLEl.value),localStorage.setItem("ocUploadSettingsWorkflowId",this.workflowIdEl.value),localStorage.setItem("ocUploadSettingsLoginName",this.loginNameEl.value),localStorage.setItem("ocUploadSettingsLoginPassword",this.loginPasswordEl.value),this.toggleModalEl.checked=!1},getServerUrl:function(){let e=this.serverURLEl.value;return e.endsWith("/")?e:e+"/"},getWorkflowId:function(){return this.workflowIdEl.value},getLoginName:function(){return this.loginNameEl.value},getLoginPassword:function(){return this.loginPasswordEl.value}},f.prototype={constructor:f,emitSOCKET:function(){if(!this.socket)throw new Error("socket not initialized (io not found)");let e=Array.prototype.slice.call(arguments);this.socket.emit.apply(this.socket,e)},switchTransport:function(e){if(["SOCKET"].indexOf(e)>-1)return this.emit=this.__proto__[`emit${e}`],!0},emit:function(){}};var v=new f;const y=new n,b=new class extends s{constructor(){super(),this.video={},this.audio={},this.desktop=new c({deviceId:"desktop",groupId:"",kind:"desktopinput",deviceType:"desktop",label:"Desktop"}),this.desktop.on("stream",e=>{this.emit("stream",{id:"desktop",stream:e}),this.isRecording&&this.desktop.record()}),this.desktop.on("record.stop.stream.remove",e=>{this.emit("record.stop.stream.remove",{id:"desktop",stream:e})}),Object.defineProperty(this,"devices",{get:function(){let e={desktop:this.desktop};for(let t in this.video)"default"!==t&&(e[t]=this.video[t]);for(let t in this.audio)"default"!==t&&(e[t]=this.audio[t]);return e}});let e=!1;Object.defineProperty(this,"isRecording",{get:function(){return e},set:function(t){if("boolean"!=typeof t)throw new Error("Please provide of a boolean value for assignment instead of this "+typeof t);e=t}}),navigator.mediaDevices.enumerateDevices().then(e=>{["audio","video"].forEach(t=>{this[t]=e.filter(e=>e.kind===`${t}input`).reduce((e,t)=>(e[t.deviceId]=new c(t),e[t.deviceId].on("stream",i=>{this.emit("stream",{id:t.deviceId,stream:i}),this.isRecording&&e[t.deviceId].record(),i.getAudioTracks().length>0&&this.desktop.attachAudioTrack(i)}),e[t.deviceId].on("record.stop.stream.remove",e=>{this.emit("record.stop.stream.remove",{id:t.deviceId,stream:e})}),e),{})}),this.emit("enumerated",this.devices);for(let e in this.devices)this.devices[e].on("record.prepare",t=>this.emit("record.prepare",{label:t,id:e,flavor:"desktop"===e?"Presentation":"Presenter"})),this.devices[e].on("record.complete",t=>this.emit("record.complete",{media:t.media,url:t.url,id:e})),this.devices[e].on("stream.mute",()=>this.emit("stream.mute",e))})}connect(e,t){return"desktop"==e?this.desktop.connect():this.video.hasOwnProperty(e)?this.video[e].connect(t):this.audio.hasOwnProperty(e)?this.audio[e].connect(t):new Promise((e,t)=>t("no such device"))}record(){for(var e in this.devices)this.devices[e].stream&&this.devices[e].record();this.isRecording=!0}pauseRecording(){for(var e in this.devices)this.devices[e].stream&&this.devices[e].pauseRecording()}stopRecording(){for(var e in this.devices)this.devices[e].stream&&this.devices[e].stopRecording();this.isRecording=!1}changeResolution(e,t){return new Promise((i,s)=>{this.devices.hasOwnProperty(e)?this.devices[e].changeResolution(t).then(t=>i({id:e,stream:t})).catch(e=>s(e)):s("no such device")})}},w=new d,E=new h,S=new m,k=new g,T={};function C(){let e=document.querySelectorAll(".mediadevice[data-target]");this.mediaElements=[...e].reduce((e,t)=>(e[t.getAttribute("data-target")]=t.querySelector(":first-child"),e),{}),this.mediaToggles=[...document.querySelectorAll(".streamToggle")].reduce((e,t)=>(e[t.name]=t,e),{}),this.addDeviceToggle=document.getElementById("addDevice"),this.cover=document.getElementById("cover"),this.deviceList=document.querySelector("#streams .list"),this.audioCanvas=document.querySelector("#audio ~ canvas"),this.simpleUserView=document.getElementById("simpleUserView"),this.advancedUserView=document.getElementById("advancedUserView"),this.recordButton=document.getElementById("startRecord"),this.pauseButton=document.getElementById("pauseRecord"),this.stopButton=document.getElementById("stopRecord"),this.timeEl=document.getElementById("recordingTime"),this.recTime=[],this.logNextTick=!0,this.recTimeToken=null;let t=!1,i=!1;Object.defineProperty(this,"isRecording",{get:function(){return t},set:function(e){"boolean"==typeof e&&(t=e,e?document.body.classList.add("recording"):document.body.classList.remove("recording"),this.recTimeToken||(this.recTimeToken=E.subscribe({fn:this.logRecordingTime,scope:this})))}}),Object.defineProperty(this,"isPaused",{get:function(){return i},set:function(e){"boolean"==typeof e&&(i=e,this.logNextTick=!0,e?document.body.classList.add("paused"):document.body.classList.remove("paused"))}});let s=!1;Object.defineProperty(this,"needsExtension",{get:function(){return s},set:function(e){"boolean"==typeof e&&(s=e,e&&document.body.classList.add("extensionRequired"))}}),this.title="",this.presenter="",this.location="",this.titleEl=document.querySelector("#saveCreation input[name=title]"),this.presenterEl=document.querySelector("#saveCreation input[name=presenter]"),this.uploadOcRecordings=document.getElementById("uploadOcRecordings"),this.saveRecordings=document.getElementById("saveRecordings"),this.discardRecordings=document.querySelector("label[for=toggleSaveCreationModal]"),this.socketId=null,this.listingPeer=[],this.attachEvents(),document.getElementById("create").checked=!0,setTimeout(()=>{document.body.classList.remove("loading")},500)}C.prototype={constructor:C,attachEvents:function(){b.on("enumerated",()=>{for(let e in b){let t=(b[e].info||{}).deviceId||Object.keys(b[e]).filter(e=>"default"!==e).reduce((e,t)=>e=e||t,null);this.mediaToggles[e].value=t}});for(let e in this.mediaToggles)this.mediaToggles[e].checked=!1,this.mediaToggles[e].addEventListener("change",this.toggleStream.bind(this),!1);S.attachCanvas(this.audioCanvas),S.ondelegation("subscribe.raf",(function(){let e=Array.prototype.slice.call(arguments),t=E.subscribe({fn:e[0],scope:S});e[1]&&e[1](t)})),S.ondelegation("pause.raf",e=>{E.pauseExecution(e)}),S.ondelegation("resume.raf",e=>{E.resumeExecution(e)}),this.addDeviceToggle.addEventListener("click",this.toggleAddDevice,!1),document.getElementById("installExtension").addEventListener("click",this.chromeInstall.bind(this),!1),document.getElementById("mergestreams").addEventListener("change",this.mergeStreams.bind(this),!1),document.body.addEventListener("keyup",this.handleKeys.bind(this),!1),this.recordButton.addEventListener("click",this.startRecord.bind(this),!1),this.pauseButton.addEventListener("click",this.pauseRecord.bind(this),!1),this.stopButton.addEventListener("click",this.stopRecord.bind(this),!1),this.titleEl.addEventListener("keyup",this.updateTitleKeyUpEvent.bind(this),!1),this.presenterEl.addEventListener("keyup",this.updatePresenterKeyUpEvent.bind(this),!1),this.uploadOcRecordings.addEventListener("click",this.uploadMediaOc.bind(this),!1),this.saveRecordings.addEventListener("click",this.saveMedia.bind(this),!1),document.getElementById("minimiseStreams").addEventListener("change",this.minimiseStreamView.bind(this),!1),[...document.querySelectorAll(".streamControls label:nth-of-type(1) button")].forEach(e=>{e.addEventListener("click",this.chooseResolution.bind(this),!1)}),document.getElementById("unmerge").addEventListener("click",this.unmergeStreams.bind(this),!1)},switchCreateView:function(e){this[`${e.target.value}UserView`].checked=!0},toggleStream:function(e){e.target.checked&&("desktop"===e.target.value&&this.needsExtension&&(document.getElementById("toggleExtensionModal").checked=!0),b.connect(e.target.value).catch(t=>{e.target.checked=!1,console.log(t)}))},displayStream:function(e,t){let i=null;[...document.querySelectorAll(`video[data-id="${t}"],audio[data-id="${t}"]`)].forEach(t=>{t.srcObject=e,t.muted=!0,t.parentNode.classList.add("active"),t.parentNode.querySelector(".streamControls")&&(i=t.parentNode),t.parentNode.classList.contains("front")&&t.parentNode.parentNode.parentNode.classList.add("active")});let s=this.mediaElements.audio.parentNode;if(e.getAudioTracks().length>0&&(!s.classList.contains("active")||0===e.getVideoTracks().length)){s.classList.add("active"),S.analyse(e);let t=this.mediaToggles.audio.value,i=document.querySelector(`#streams li.audioDevice[data-id="${t}"]`);i&&i.classList.add("active")}if(e.getVideoTracks().length>0&&i&&"videoView"===i.parentNode.id){let t=e.getVideoTracks()[0].getSettings().height+"p",s=i.querySelector(".streamControls");s.querySelector("label:first-of-type span").textContent=t;let r=[...s.querySelectorAll("label:first-of-type button")],o=!0;r.some(e=>{e.value!==t||(o=!1)}),o&&r.some((e,i)=>{if(parseInt(t)<parseInt(e.value)||i===r.length-1){let i=document.createElement("button");return e.type="button",e.textContent=e.value=t,parseInt(t)<parseInt(e.value)?e.parentNode.insertBefore(i,e):e.parentNode.appendChild(i),void i.addEventListener("click",this.chooseResolution.bind(this),!1)}})}},switchStream:function(e){let t=e.target.value,i=e.target.parentNode;for(;i&&!i.querySelector("video");)i=i.parentNode;if(!i)return console.log("no vid elements");let s=i.querySelector("video");if(s.getAttribute("data-id")===t)return;let r=this.getStreamSource(t,!!e.target.getAttribute("data-peer"));if(!r)return console.log("no such stream source for switching");s.srcObject=r,s.setAttribute("data-id",t),i.querySelector("label[for^=inputSource] > span").textContent=e.target.getAttribute("data-label")},getStreamSource:function(e,t){if(t){if(T[e]&&T[e].stream)return T[e].stream}else if(b.video[e])return b.video[e].stream},chooseResolution:function(e){let t=e.target.value,i=e.target.parentNode;for(;i&&!i.classList.contains("mediadevice");)i=i.parentNode;if(this.isRecording)return void console.log(i.querySelector("video").videoHeight);let s=i.getAttribute("for"),r=document.getElementById(s).value;i.querySelector(".streamControls input:nth-of-type(1)").checked=!1,this.changeResolution(r,t).then(e=>this.displayStream(e.stream,"desktop"===r?"desktop":"video",r))},changeResolution:function(e,t){if(T.hasOwnProperty(e))return T[e].changeResolution(t);switch(e){case"composite":return w.changeResolution(t);default:return w.removeStream(e),b.changeResolution(e,t)}},removeStream:function(e){let t=document.getElementById(e);e&&(t.srcObject=null,t.parentNode.classList.remove("active"))},muteStream:function(e){let t=document.querySelector(`video[data-id="${e}"]`),i=document.querySelector(`aud[data-id="${e}"]`);t&&(t.muted=!0),i&&(i.muted=!0)},listDevices:function(e){for(let t in e){let i=o.createElement("li",{class:`${e[t].deviceType} ${e[t].deviceType}Device`,data:{id:t,title:e[t].info.label.split(" ")[0]}}),s=e[t].deviceType;s="desktop"===s?"video":s;let r=o.createElement("span",{class:"placeholder"}),n=o.createElement("span",{class:"shadow"}),a=o.createElement(s,{data:{id:t}}),c=o.createElement("span",{class:"mediaContainer"}),d=o.createElement("span",{class:"front"}),l=o.createElement("ul",{class:"back"}),h=o.createElement("li"),u=o.createElement("button",{text:"Deactivate"});h.appendChild(u);let m=o.createElement("li"),p=o.createElement("button",{text:"Add to composite"});m.appendChild(p);let g=o.createElement("li",{text:"Cancel"});l.appendChild(h),l.appendChild(m),l.appendChild(g);o.createElement("span",{class:"options"}),o.createElement("button",{text:"Add to composite",data:{action:"composite"}});d.appendChild(a),c.appendChild(d),c.appendChild(l),i.appendChild(c),i.appendChild(r),i.appendChild(n),this.deviceList.appendChild(i),i.addEventListener("click",this.toggleDevice.bind(this),!1),this.mediaElements[e[t].deviceType].getAttribute("data-id")||this.mediaElements[e[t].deviceType].setAttribute("data-id","desktop"===s?"desktop":t)}},listPeer:function(e){if(-1===this.listingPeer.indexOf(e)){this.listingPeer.push(e);let t=o.createElement("li",{class:"peerDevice connecting",data:{id:e}});this.deviceList.appendChild(t),t.addEventListener("click",this.togglePeerStream.bind(this),!1),setTimeout(()=>{this.addLoader(t,"Connecting",{fill:"#eee",fontSize:"1.75rem"})},500)}},listAsSource:function(e){let t=document.querySelectorAll(".inputSource ul");Object.keys(e).filter(t=>"video"==e[t].deviceType).forEach(i=>{if(!t[0].querySelector(`li[data-id="${i}"]`)){let s=o.createElement("li",{data:{id:i}}),r=o.createElement("button",{text:e[i].info.label,value:i,data:{label:e[i].info.label}});if("peer"==e[i].source){let t=e[i].info.type;r.setAttribute("data-peer",t)}s.appendChild(r),t.forEach(e=>{let t=s.cloneNode(!0);e.appendChild(t),t.addEventListener("click",this.switchStream.bind(this),!1)})}}),t.forEach(e=>{e.style.maxHeight=2*([...e.querySelectorAll("li")].length+1)+"rem"})},toggleAddDevice:function(e){v.emit("initiatePair")},togglePeerStream:function(e){console.log(e.target.getAttribute("data-id"))},displayPairCode:function(e){let t=document.querySelector("#codehref");if(document.querySelector("#addDeviceModal canvas"))return;let i="/pair/?code="+e;t.href=i;let s=t.href;t.textContent=s,new QRCode(document.getElementById("qrcode"),{text:s,width:240,height:240,correctLevel:QRCode.CorrectLevel.L});let r=document.getElementById("host");r.textContent=s.split("/").slice(0,4).join("/"),r.href=i,r.target="_blank",document.getElementById("paircode").textContent="",e.split("").forEach(e=>{let t=document.createElement("span");t.textContent=e,document.getElementById("paircode").appendChild(t)})},toggleDevice:function(e){let t=e.target;for(;t&&"li"!=t.tagName.toLowerCase();)t=t.parentNode;if(t.classList.contains("active")){t.classList.toggle("toggled");let e=t.querySelector(".mediaContainer");return void(e&&e.classList.toggle("toggled"))}let i=t.getAttribute("data-id"),s=document.querySelector('input[value="'+i+'"]');s&&!s.checked&&(s.checked=!0,s.dispatchEvent(new Event("change")))},mergeStreams:function(e){e.target.checked?(w.start(),S.switchDraw("drawMerged")):(w.stop(),S.switchDraw("draw"))},unmergeStreams:function(e){let t=document.getElementById("mergestreams");t.checked=!1,t.dispatchEvent(new Event("change"))},minimiseStreamView:function(e){let t=e.target.checked?"Maximise":"Minimise";document.querySelector("label[for=minimiseStreams]").setAttribute("title",t),e.target.checked?this.addDeviceToggle.setAttribute("title",y.translate("ADD_DEVICE")):this.addDeviceToggle.removeAttribute("title")},handleKeys:function(e){switch(e.keyCode||e.which){case 27:[...document.querySelectorAll(".toggleCover:checked")].forEach(e=>e.checked=!1)}},chromeInstall:function(){chrome&&chrome.app&&chrome.webstore.install(this.chromeStoreLink,(function(){location.reload()}),(function(e){console.log("error installing",e)}))},startRecord:function(e){if(this.isRecording){this.isPaused=!1,b.record(),w.record();for(let t in T)try{T[t].record()}catch(e){}return}if(0!==Object.keys(b.devices).map(e=>b.devices[e].stream).filter(e=>e).length){this.isRecording=!0,b.record(),w.record();for(let t in T)try{T[t].record()}catch(e){}[...document.querySelectorAll("#recordingList a")].forEach(e=>e.parentNode.removeChild(e))}},pauseRecord:function(e){b.pauseRecording(),w.pauseRecording();for(let e in T)T[e].pauseRecording();this.isPaused=!this.isPaused},stopRecord:function(e){if(this.isRecording){this.isRecording=!1,this.isPaused=!1,b.stopRecording(),w.stopRecording();for(let e in T)T[e].stopRecording();this.titleEl.value="",this.presenterEl.value="",this.setTitle(""),this.setPresenter(""),document.getElementById("toggleSaveCreationModal").checked=!0,E.unsubscribe(this.recTimeToken),this.recTimeToken=null,this.recTime=[]}},logRecordingTime:function(e){if(this.logNextTick&&(this.recTime.push(e),this.logNextTick=!1),this.isPaused)return;let t=e-this.recTime.reduce((e,t,i)=>e+=t*(i%2?-1:1),0),i=[t/36e5>>0,(t/6e4>>0)%60,(t/1e3%60).toFixed(3)].map((e,t)=>(e<10?"0":"")+e);this.timeEl.textContent=i.join(":")},listRecording:function(e){let t=document.createElement("a");if(t.target="_blank",t.textContent=e.label,t.setAttribute("data-id",e.id),t.setAttribute("data-flavor",e.flavor),document.getElementById("recordingList").appendChild(t),"remote"===e.flavor&&T[e.id].capabilities.MediaRecorder){let i=document.createElement("button");i.value=e.id,i.className="requestRaw",i.addEventListener("click",this.requestRawFootage.bind(this),!0),i.textContent=y.translate("RAW_FOOTAGE");let s=document.querySelector("#introCover .loader").cloneNode(!0);s.querySelector("circle").setAttributeNS(null,"stroke-width","12"),s.querySelector(".loaderText").textContent="Incoming Transfer",t.appendChild(i),t.appendChild(s)}},setMediaLink:function(e){let t=document.querySelector(`a[data-id="${e.id}"]`);if(t)if(t.href=e.url,e.media.type.indexOf("video")>-1){t.setAttribute("data-type","video"),t.download=t.getAttribute("data-flavor")+" video - "+this.title+".webm",t.querySelector("video")&&t.removeChild(t.querySelector("video"));let i=document.createElement("video");i.src=e.url,i.muted=!0,i.addEventListener("mouseover",e=>i.play(),!1),i.addEventListener("mouseout",e=>i.pause(),!1),i.addEventListener("ended",e=>i.currentTime=0,!1),t.appendChild(i)}else t.download=t.getAttribute("data-flavor")+" audio - "+this.title+".webm",t.setAttribute("data-type","audio")},requestRawFootage:function(e){e.preventDefault(),e.stopImmediatePropagation();let t=e.target.value;T.hasOwnProperty(t)&&(T[t].progress=e.target.parentNode.querySelector(".loader circle"),T[t].dataChannel.send("request.filetransfer"),e.target.parentNode.classList.add("transfer"))},updateTitleKeyUpEvent(e){this.setTitle(e.target.value)},setTitle:function(e){this.title=e||"Recording",[...document.querySelectorAll("#recordingList a")].forEach(e=>{e.download=e.getAttribute("data-flavor")+" "+e.getAttribute("data-type")+" - "+this.title+".webm"})},updatePresenterKeyUpEvent(e){this.setPresenter(e.target.value)},setPresenter:function(e){this.presenter=e},setLocation:function(e){this.location=e.target.value},uploadMediaOc:function(e){let t=this.title,i=this.presenter;""!==t&&""!==i?new p(k).loginAndUploadFromAnchor([...document.querySelectorAll("#saveCreation a")],()=>{alert("Upload complete!"),document.getElementById("toggleSaveCreationModal").checked=!1},()=>{alert("Login failed, Please check your Password!"),k.show()},e=>{alert("Server unreachable: Check your Internet Connetion and the Server Url, also check whether your Opencast Instance supports this site."),console.log("Server unreachable: ",e),k.show()},e=>{alert("The Internet Connection failed or you are missing necessary permissions."),console.log("Inet fail or Missing Permission: ",e),k.show()},t,i):alert("Please set Title and Presenter")},saveMedia:function(e){[...document.querySelectorAll("#saveCreation a")].forEach((e,t)=>setTimeout(()=>e.click(),100*t)),document.getElementById("toggleSaveCreationModal").checked=!1},changeLanguage:function(e){let t=e.target.parentNode.querySelector("button").value;y.setLanguage(t)},addLoader:function(e,t,i){let s=document.querySelector("#introCover .loader"),r=s.cloneNode(!0);r.querySelector(".loaderText").textContent=t||"";let o=Math.min(e.clientWidth,e.clientHeight),n=Math.min(.8*o,s.clientWidth);r.style.transform=`translate(-50%, -50%) scale(${n/s.clientWidth})`,e.appendChild(r),i&&(i.fill&&r.querySelector("circle:nth-of-type(2)").setAttribute("stroke",i.fill),i.fontSize&&(r.querySelector(".loaderText").style.fontSize=i.fontSize))},setLanguage:function(e){if(document.documentElement.lang=e.language,document.body.classList.add("translating"),!document.head.querySelector(`link[data-lang=${e.language}`)){let t=document.createElement("link");t.rel="stylesheet",t.href=`/css/translations_${e.language}.css`,document.head.appendChild(t)}let t=document.getElementById("chosenLanguage");t.querySelector("span").textContent=e.short.toUpperCase(),t.querySelector("img").src=e.img,[...document.querySelectorAll("[data-translate]")].forEach(t=>{let i=t.getAttribute("data-translate");e.translation&&e.translation[i]&&(t.textContent=e.translation[i])}),[...document.querySelectorAll("[data-pseudotext]")].forEach(t=>{let i=t.getAttribute("data-pseudotext");e.translation&&e.translation[i]&&t.setAttribute("data-title",e.translation[i])}),[...document.querySelectorAll("[data-translatetitle]")].forEach(t=>{let i=t.getAttribute("data-translatetitle");e.translation&&e.translation[i]&&(t.title=e.translation[i])}),document.getElementById("addDevice").title&&(document.getElementById("addDevice").title=y.translate("ADD_DEVICE")),document.body.classList.remove("translating")},addPeerStreamToComposite:function(e){let t=e.target;for(;t&&!t.getAttribute("data-id");)t=t.parentNode;if(!t)return console.log("no such item");let i=t.getAttribute("data-id");return T[i]?T[i].stream?void w.addStream({id:i,stream:T[i].stream}):console.log("requested peer has no stream"):console.log("no such peer")},removePeer:function(e){[...document.querySelectorAll(`.streamControls [data-id="${e}"], #streams [data-id="${e}"]`)].forEach(e=>e.parentNode.removeChild(e)),[...document.querySelectorAll(`video[data-id="${e}"], audio[data-id="${e}"]`)].forEach(e=>e.srcObject=null)},cacheApp:function(){navigator.serviceWorker.register("/sw.js").catch(e=>console.log("failed to register sw",e))}};const x=new C;if(y.on("translations.languages",e=>{let t=document.querySelector("#language ul");t.innerHTML="",e.forEach(e=>{let i=document.createElement("li"),s=o.createElement("button",{type:"button",value:e.short,text:e.language}),r=o.createElement("img",{prop:{alt:e.language,src:e.img},data:{attribution:"Icon made by Freepik from www.flaticon.com"}});i.appendChild(s),i.appendChild(r),i.addEventListener("click",x.changeLanguage.bind(x),!0),t.appendChild(i)})}),y.on("translations.set",e=>x.setLanguage(e)),b.once("enumerated",{fn:e=>{x.listDevices(e),x.listAsSource(e)}}),[b,w].forEach(e=>{e.on("record.prepare",e=>{x.listRecording(e)}),e.on("record.complete",e=>{x.setMediaLink(e)})}),[b,w].forEach(e=>{e.on("stream.mute",e=>{x.muteStream(e)}),e.on("stream",t=>{t.stream.getTracks().forEach(e=>{e.onended=function(){x.stopRecord(),b.stopRecording()}}),x.displayStream(t.stream,t.id),x.isRecording&&e.record(t.id),"composite"!==t.id&&(t.stream.getVideoTracks().length>0?w.addStream(t):t.stream.getVideoTracks().length>0&&w.addAudioTrack(t.stream.getAudioTracks()[0]))}),e.on("record.stop.stream.remove",e=>{[...document.querySelectorAll(`video[data-id="${e.id}"],audio[data-id="${e.id}"]`)].forEach(e=>{e.parentNode.classList.remove("active"),e.load();let t=e.parentNode.getAttribute("for");t&&(document.getElementById(t).checked=!1)})})}),w.on("subscribe.raf",(function(){let e=Array.prototype.slice.call(arguments,0,2);E.subscribe({fn:e[0],scope:w},e[1])})),w.on("unsubscribe.raf",e=>{E.unsubscribe(e)}),w.on("stream.remove",()=>{x.removeStream("composite")}),window.chrome&&window.chrome.app&&!(navigator.mediaDevices&&"getDisplayMedia"in navigator.mediaDevices)){let e=setTimeout(()=>{x.needsExtension=!0},1e3);window.addEventListener("message",t=>{t.data.type&&"SS_PING"==t.data.type&&document.getElementById("appInstalled")&&clearTimeout(e)})}null!==v.socket&&v.socket.on("peerConnection",e=>{document.getElementById("toggleAddDeviceModal").checked=!1,document.querySelector('button[data-stream="'+e.target+'"]')||x.listPeer(e.target)}),"serviceWorker"in navigator&&"caches"in window&&x.cacheApp()}]);